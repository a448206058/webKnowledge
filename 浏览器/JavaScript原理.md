## 块级作用域

### 作用域（scope）
作用域是指在程序中定义变量的区域，该位置决定了变量的生命周期。通俗地理解，作用域就是变量与函数的可访问范围，即作用域控制着变量和函数的可见性和生命周期。

在ES6之前，作用域只有俩种：全局作用域和函数作用域
* 全局作用域中的对象在代码中的任何地方都能访问，其生命周期伴随着页面的生命周期
* 函数作用域就是在函数内部定义的变量或者函数，并且定义的变量或者函数只能在函数内部被访问。函数执行结束之后，函数内部定义的变量会被销毁。

* let、const 声明快级作用域：作用块内声明的变量不影响块外面的变量

块级作用域是通过词法环境的栈结构来实现的，而变量提升是通过变量环境来实现，通过这俩者的结合，JavaScript引擎也就同时支持了变量提升和块级作用域了

## 作用域和闭包
### 作用域链
在每个执行上下文的变量环境中，都包含了一个外部引用，用来指向外部的执行上下文，我们把这个外部引用称为outer

当一段代码使用了一个变量时，JavaScript引擎首先会在“当前的执行上下文”中查找该变量，如果在当前的变量环境中没有查找到，那么JavaScript引擎会继续在outer所指向的执行上下文中查找。我们把这个查找的链条称为作用域链

### 词法作用域
词法作用域就是指作用域是由代码中函数声明的位置来决定的，所以词法作用域是静态的作用域，通过它就能够预测代码在执行过程中如何查找标识符。

词法作用域是代码阶段就决定好的，和函数是怎么调用的没有关系

### 闭包
在JavaScript中，根据词法作用域的规则，内部函数总是可以访问其外部函数中声明的变量，当通过调用一个外部函数返回一个内部函数后，即使该外部函数已经执行结束了，但是内部函数引用外部函数的变量依然保存在内存中，我们就把这些变量的集合称为闭包。

使用闭包的原则：如果该闭包会一直使用，那么它可以作为全局变量而存在；但如果使用频率不高，而且占用内存又比较大的话，那就尽量让它成为一个局部变量。

## this
执行上下文中包含了变量环境、词法环境、外部环境和this

this是和执行上下文绑定的
执行上下文主要分为三种——全局执行上下文、函数执行上下文和eval执行上下文

### 全局执行上下文中的this
全局执行上下文中的this是指向window对象的，这也是this和作用域的唯一交点，作用域链的最底端包含了window对象，全局执行上下文中的this也是指向window对象

### 函数执行上下文中的this
默认情况下也是指向window

### 改变this的指向
1. 通过call、apply
2. 通过对象调用方法设置：使用对象来调用其内部的一个方法，该方法的this是指向对象本身的。
在全局环境中调用一个函数，函数内部的this指向的是全局变量window
3. 通过构造函数中设置 new

### 总结
1. 当函数作为对象的方法调用时，函数中的this就是该读喜庆
2. 当函数被正常调用时，在严格模式下，this值是undefined，非严格模式下this指向的是全局对象window;
3. 嵌套函数中的this不会继承外层函数的this值

## 栈空间和堆空间
在使用之前就需要确认其变量数据类型的称为静态语言，把在运行过程中需要检查数据类型的语言称为动态语言。

支持隐式类型转换的语言称为弱类型语言，不支持隐式类型转换的语言称为强类型语言。

### JavaScript的数据类型
JavaScript是一种弱类型的、动态的语言

JavaScript的数据类型一共有8种：Boolean、Null、Undefined、number、string、BigInt、symbol、Object

### 内存空间
代码空间、栈空间、堆空间

原生类型的数据值都是直接保存在栈中的，引用类型的值是存放在堆中的。

原始类型的赋值会完整复制变量值，而引用类型的赋值是复制引用地址。

### 闭包
产生闭包的核心有俩步：第一步是需要预扫描内部函数；第二步是把内部函数引用的外部变量保存到堆中。