## Chrome架构

### 什么是并行处理
并行处理就是采用多线程处理，使用并行处理能大大提升性能

### 线程 VS 进程
多线程可以并行处理任务，但是线程是不能单独存在的，它是由进程来启动和管理的。

一个进程就是一个程序的运行实例。

线程是依附于进程的，而进程中使用多线程并行处理能提升运算效率。

进程和线程之间的关系特点：
1. 进程中任意一线程执行出错，都会导致整个进程崩溃。

2. 线程之间共享进程中的数据。

3. 当一个进程关闭之后，操作系统会回收进程所占用的内存。

4. 进程之间的内容相互隔离。

### 单进程浏览器时代
单进程浏览器是指浏览器所有功能模块都是运行在同一个进程里。

这些模块包含了网络、插件、JavaScript运行环境、渲染引擎和页面等。

如此多的功能模块运行在一个进程里，是导致单进程浏览器不稳定、不流畅和不安全的一个主要因素。

### 不稳定
插件和渲染引擎模块是不稳定的，本身的崩溃会导致整个浏览器崩溃

### 不流畅
脚本、插件、页面的内存泄露都会让单进程变慢

### 不安全
插件自身或者脚本可以通过浏览器漏洞来获取系统权限来对电脑做一些恶意的事情，引发安全问题

### 多进程浏览器时代
不稳定：进程是相互隔离的，当一个页面或者插件崩溃，影响到的仅仅是当前的页面进程或者插件进程

不流畅：影响到的是当前渲染页面

不安全：采用多进程架构的额外好处就是可以使用安全沙箱，Chrome把插件进程和渲染进程锁在沙箱里面

### Chrome进程架构
1个浏览器主进程（Browser Process）
>主要负责界面显示、用户交互、子进程管理，同时提供存储等功能。

多个渲染进程（Render Process）
>核心任务是将HTML、CSS和JavaScript转换为用户可以与之交互的网页，排版引擎BLink和JavaScript引擎V8都是运行在该进程中，Chrome会为每个Tab标签创建一个渲染进程，处于安全考虑，渲染进程都是运行在沙箱模式下。

1个GPU进程（GPU Process）
>绘制UI界面

1个网络进程（NewWork Process）
>主要负责页面的网络资源加载，之前是作为一个模块运行在浏览器里面

多个插件进程（Plugin Process）
>主要负责插件的运行

### 未来面向服务架构
Chrome最终要把UI、数据库、文件、设备、网络等模块重构为基础服务，类似于操作系统底层服务

## TCP协议：如何保证页面文件能被完整送达浏览器？
**FP（First Paint）**指从页面加载到首次开始绘制的时长。
影响FP指标的一个重要因素是网络加载速度。

在网络中，一个文件通常会被拆分为很多数据包来进行传输，而数据包在传输过程中又有很大概率丢失或者出错。**如何保证页面文件能被完整地送达浏览器？**

互联网，实际上是一套理念和协议组成的体系架构。

IP：把数据包送达目的地主机
计算机的地址就称为IP地址，访问任何网站实际上知识你的计算机向另外一台计算机请求信息。

UDP：把数据包送达应用程序
IP通过IP地址信息把数据包发送给指定的电脑，而UDP通过端口号把数据包分发给正确的程序。

UDP不能保证数据可靠性，但是传输速度非常快，所以UDP会应用在一些关注速度、但不那么严格要求数据完整性的领域，如在线视频、互动游戏等。

TCP：把数据完整地送达应用程序
TCP是一种面向连接的、可靠的、基于字节流的传输层通信协议

UDP有俩个问题
* 数据包在传输过程中容易丢失
* UDP协议并不知道如何组装数据包，从而把这些数据包还原成完整的文件

TCP解决
* 对于数据包丢失的情况，TCP提供重传机制；
* TCP引入了数据包排序机制，用来保证把乱序的数据包组合成一个完整的文件

一个完整的TCP连接的生命周期包括了
**建立连接** 三次握手
**传输数据** 接收端需要对每个数据包进行确认操作
**断开连接** 四次挥手



